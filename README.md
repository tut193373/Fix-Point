# Fix-Point
programming test

# 出力画面
 ![キャプチャ](https://user-images.githubusercontent.com/58971155/151766564-068169a4-6c00-44df-a5ff-194888d4ce69.JPG)
各設問に応じて、メッセージを出力させます。
(設問1)span (year)/(month)/(day) (hour):(minutes):(seconds)
(設問2)recovery
(設問3)overload (year)/(month)/(day) (hour):(minutes):(seconds)
(設問4)There may be a switch failure on this network.
 
# 特徴
 
C++でプログラムを組みました。
実行の際はコマンドライン引数に「n m t」の順番で渡す必要があります。

構成は以下のようになっています。  
.  
├── main.cpp  
├── log_structure.cpp  
├── log_structure.h  
└── network_log.txt  
 
 *main.cpp*  
 ログの読み込みや日付の処理など、全体の処理を記述しています。
 
 *log_structure.cpp*  
 ログデータを保持するクラス構造体のコンストラクタなどを定義しています。
 
 *log_structure.h*  
 ログをクラスとして扱ったほうが楽だと考えたため、クラスを用意しました。
 
 *network_log.txt*  
 ログがどのような形式で記録されているのか指定がなかったので、テキストファイルとしました。
 
# 動作環境

以下の環境で動作を確認しました。  
* 言語：C++ 1.7  
* 開発環境：Visual Studio 2019  
* OS：Windows 10  
 
# テスト
 
例題のログファイルと同様のフォーマットで、ランダムなデータを用意して正しく処理ができていることを確認しました。  
フォーマットは以下の通りです。  
* (4桁年)(2桁月)(2桁日)(2桁時)(2桁分)(2桁秒),(8bit)(8bit)(8bit)(8bit)/(プレフィックス),(ランダム値)  
- 前半は年月日、処理の都合上桁数は固定とした。  
- IPv4はサブネットを2パターン（"192.168.1.◯"と"10.20.◯◯"）のものと、ホスト部を1～3で変化させたもので用意した。  
- プレフィックスはサブネットマスクに合わせて設定した。
- ランダム値は10～40の値、もしくは"-"を与えるように設定した。
作成したテキストファイルは"network_log(test).txt"になります。（行数が多いので開くと動作が重くなるかもしれません）  

**設問1
監視ログファイルを読み込み、故障状態のサーバアドレスとそのサーバの故障期間を出力するプログラムを作成せよ。  
出力フォーマットは任意でよい。  
なお、pingがタイムアウトした場合を故障とみなし、最初にタイムアウトしたときから、次にpingの応答が返るまでを故障期間とする。  

10.20.32.1/16のネットワーク機器について注目したとき、

[Log] 20200101000050,10.20.32.1/16,28  
[Log] 20200101000055,10.20.32.1/16,31  
[Time Out] 20200101000500,10.20.32.1/16,-  
[Time Out] 20200101000505,10.20.32.1/16,-  
[Time Out] 20200101000510,10.20.32.1/16,-  
[Time Out] 20200101000515,10.20.32.1/16,-  
[Time Out] 20200101000520,10.20.32.1/16,-  
[Time Out] 20200101000525,10.20.32.1/16,-  
[Log] 20200101000530,10.20.32.1/16,32  
        (Q.1)recovery : 0/0/0 0:4:35  

(Q.1)の時間は4分35秒であり、直近の正常な値である2020年1月1日0時0分55秒との差が求められていることが分かります。

**設問2
ネットワークの状態によっては、一時的にpingがタイムアウトしても、一定期間するとpingの応答が復活することがあり、
そのような場合はサーバの故障とみなさないようにしたい。
N回以上連続してタイムアウトした場合にのみ故障とみなすように、設問1のプログラムを拡張せよ。
Nはプログラムのパラメータとして与えられるようにすること。

192.168.1.2/24のネットワーク機器について注目したとき、  

[Log] 20200101030500,192.168.1.2/24,27  
        (Q.1)recovery : 0/0/0 0:4:10  
                        (Q.3)overload : mean 34.3333  

[Time Out] 20200101030505,192.168.1.2/24,-  

[Time Out] 20200101030510,192.168.1.2/24,-  

[Time Out] 20200101030515,192.168.1.2/24,-  

[Time Out] 20200101030520,192.168.1.2/24,-  
                (Q.2)span 0/0/0 0:0:20  
                (Q.2)network failure  

一定回数タイムアウトが続いた場合の故障期間が出力できていることがわかる。  

**設問3
サーバが返すpingの応答時間が長くなる場合、サーバが過負荷状態になっていると考えられる。
そこで、直近m回の平均応答時間がtミリ秒を超えた場合は、サーバが過負荷状態になっているとみなそう。
設問2のプログラムを拡張して、各サーバの過負荷状態となっている期間を出力できるようにせよ。mとtはプログラムのパラメータとして与えられるようにすること。

10.20.30.2/16のネットワーク機器について注目したとき、  

[Log] 20200101030025,10.20.30.2/16,32  

[Time Out] 20200101030030,10.20.30.2/16,-  

[Time Out] 20200101030035,10.20.30.2/16,-  

[Time Out] 20200101030040,10.20.30.2/16,-  
  
[Log] 20200101030045,10.20.30.2/16,33  
        (Q.1)recovery : 0/0/0 0:0:20  
                        (Q.3)overload : mean 31.6667  
                        
[Log] 20200101030050,10.20.30.2/16,28  
                        (Q.3)overload : mean 31  

最後の(Q.3)のmean 31は直近の応答時間の32, 33, 28の平均を表していることが分かる。  
このとき、途中のタイムアウトログは無視して3か所の平均を計算している。  

**設問4
ネットワーク経路にあるスイッチに障害が発生した場合、そのスイッチの配下にあるサーバの応答がすべてタイムアウトすると想定される。
そこで、あるサブネット内のサーバが全て故障（ping応答がすべてN回以上連続でタイムアウト）している場合は、
そのサブネット（のスイッチ）の故障とみなそう。
設問2または3のプログラムを拡張して、各サブネット毎にネットワークの故障期間を出力できるようにせよ。

192.168.1.◯/24のサブネット内のエラーについて注目したとき、  

[Log] 20200101030500,192.168.1.2/24,27  
        (Q.1)recovery : 0/0/0 0:4:10  
                        (Q.3)overload : mean 34.3333  
                        
[Log] 20200101030505,192.168.1.1/24,37  

[Time Out] 20200101030505,192.168.1.2/24,-  

[Time Out] 20200101030510,192.168.1.1/24,-  

[Time Out] 20200101030510,192.168.1.2/24,-  

[Time Out] 20200101030515,192.168.1.1/24,-  

[Time Out] 20200101030515,192.168.1.2/24,-  

[Time Out] 20200101030520,192.168.1.1/24,-  

[Time Out] 20200101030520,192.168.1.2/24,-  
                                (Q.4)There may be a switch failure on this network.  

同一のサブネット内の機器が一定回数タイムアウトしているときに障害を検知していることが確認できる。
                                
                                

次に、同様のデータを用いて動作速度を確認しました。
各行を読み込んでから処理するまでの時間をミリ秒単位で計測しています。  
結果は以下のグラフの通りです。  

![画像1](https://user-images.githubusercontent.com/58971155/151848254-3fb0f5ae-0c23-4db7-967d-a4d01f302b8d.jpg)

データの増加に対し処理時間が変わらないことが確認できました。
このグラフは全データを表しているわけではありませんが、十分なデータ数を可視化できていると考えています。
 
# 注意
 
simulation.pyを実行してしまうと、非常に長時間をかけてテキストファイルの書き出しをしてしまうため、実行はしないようお願いします。  
テストデータの作成にのみ使用したため、本題とは関係ありません。  
 
# 作成者
 
* 作成者：山林央樹  
* 所属：豊橋技術科学大学大学院  
* E-mail：yamabayashi.hiroki.zp@tut.jp  
